# –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã 429 (Too Many Requests) –≤ GigaChat

## –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ **2 —Å–µ–∫—É–Ω–¥—ã** –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ rate limit –ø—Ä–∏ –±—ã—Å—Ç—Ä–æ–π –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏–π

### 2. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ retry –ª–æ–≥–∏–∫–∞ –¥–ª—è –æ—à–∏–±–∫–∏ 429
- –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –æ—à–∏–±–∫–∏ 429 –∑–∞–ø—Ä–æ—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è
- –ú–∞–∫—Å–∏–º—É–º **2 –ø–æ–ø—ã—Ç–∫–∏** —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π (5, 10 —Å–µ–∫—É–Ω–¥)
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Retry-After` –∏–∑ –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞

### 3. ‚úÖ –£–ª—É—á—à–µ–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
- –¢–æ–∫–µ–Ω –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –∑–∞–ø—Ä–æ—Å–æ–º —Ç–æ–∫–µ–Ω–∞ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è rate limiting

### 4. ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–π —Ä–µ–∫—É—Ä—Å–∏–∏
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ retry –ø–æ–ø—ã—Ç–æ–∫
- –ü–æ—Å–ª–µ –∏—Å—á–µ—Ä–ø–∞–Ω–∏—è –ø–æ–ø—ã—Ç–æ–∫ –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –ø–æ–Ω—è—Ç–Ω–∞—è –æ—à–∏–±–∫–∞

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è:

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–¥–µ—Ä–∂–∫–∏** - –µ—Å–ª–∏ –ø—Ä–æ—à–ª–æ –º–µ–Ω—å—à–µ 2 —Å–µ–∫—É–Ω–¥ —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞, –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∑–∞–¥–µ—Ä–∂–∫–∞
2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞** - —Ç–æ–∫–µ–Ω –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∏—Å—Ç–µ–∫ –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
3. **–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞** - –∑–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∫ GigaChat API
4. **–û–±—Ä–∞–±–æ—Ç–∫–∞ 429** - –µ—Å–ª–∏ –ø–æ–ª—É—á–µ–Ω–∞ –æ—à–∏–±–∫–∞ 429:
   - –ß–∏—Ç–∞–µ—Ç—Å—è –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Retry-After` (–µ—Å–ª–∏ –µ—Å—Ç—å)
   - –î–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∑–∞–¥–µ—Ä–∂–∫–∞ (5-10 —Å–µ–∫—É–Ω–¥)
   - –ó–∞–ø—Ä–æ—Å –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è (–º–∞–∫—Å–∏–º—É–º 2 —Ä–∞–∑–∞)

### –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã:

```
–ó–∞–ø—Ä–æ—Å 1 ‚Üí 429 Too Many Requests
  ‚Üì (–∑–∞–¥–µ—Ä–∂–∫–∞ 5 —Å–µ–∫—É–Ω–¥)
–ó–∞–ø—Ä–æ—Å 2 ‚Üí 429 Too Many Requests  
  ‚Üì (–∑–∞–¥–µ—Ä–∂–∫–∞ 10 —Å–µ–∫—É–Ω–¥)
–ó–∞–ø—Ä–æ—Å 3 ‚Üí 200 OK ‚úÖ
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∏

–¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –≤ `AiApiClient.kt`):

```kotlin
private const val MIN_REQUEST_INTERVAL_MS = 2000L // 2 —Å–µ–∫—É–Ω–¥—ã –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
// –ú–∞–∫—Å–∏–º—É–º 2 retry –¥–ª—è 429 –æ—à–∏–±–æ–∫
// –ó–∞–¥–µ—Ä–∂–∫–∞: 5 —Å–µ–∫—É–Ω–¥ (1-—è –ø–æ–ø—ã—Ç–∫–∞), 10 —Å–µ–∫—É–Ω–¥ (2-—è –ø–æ–ø—ã—Ç–∫–∞)
```

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ù–µ –æ—Ç–ø—Ä–∞–≤–ª—è–π—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å–ª–∏—à–∫–æ–º –±—ã—Å—Ç—Ä–æ** - –≤—ã–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ –ø–∞—É–∑—É –º–∏–Ω–∏–º—É–º 2 —Å–µ–∫—É–Ω–¥—ã
2. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ª–æ–≥–∏** - –ø—Ä–∏ —á–∞—Å—Ç—ã—Ö 429 –æ—à–∏–±–∫–∞—Ö —É–≤–µ–ª–∏—á—å—Ç–µ `MIN_REQUEST_INTERVAL_MS`
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–∏–º–∏—Ç—ã –≤–∞—à–µ–≥–æ —Ç–∞—Ä–∏—Ñ–∞** - GigaChat –∏–º–µ–µ—Ç —Ä–∞–∑–Ω—ã–µ –ª–∏–º–∏—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∞—Ä–∏—Ñ–æ–≤

## –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è

1. **–£–≤–µ–ª–∏—á—å—Ç–µ –∑–∞–¥–µ—Ä–∂–∫—É** –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏:
   ```kotlin
   private const val MIN_REQUEST_INTERVAL_MS = 5000L // 5 —Å–µ–∫—É–Ω–¥
   ```

2. **–£–≤–µ–ª–∏—á—å—Ç–µ –∑–∞–¥–µ—Ä–∂–∫—É –ø—Ä–∏ retry**:
   ```kotlin
   val delaySeconds = retryAfter ?: (10L * (retryCount + 1)) // 10, 20 —Å–µ–∫—É–Ω–¥
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–∏–º–∏—Ç—ã –≤–∞—à–µ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ GigaChat** - –≤–æ–∑–º–æ–∂–Ω–æ, –ø—Ä–µ–≤—ã—à–µ–Ω –¥–Ω–µ–≤–Ω–æ–π/–º–µ—Å—è—á–Ω—ã–π –ª–∏–º–∏—Ç

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å rate limiting –≤ –ª–æ–≥–∞—Ö –≤—ã —É–≤–∏–¥–∏—Ç–µ:

```
Rate limiting: waiting 1500ms before next request
Rate limit hit (429), waiting 5s before retry (attempt 1/2)
Retrying request after rate limit delay
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ **–ó–∞–ø—Ä–æ—Å—ã –Ω–µ –ø—Ä–µ–≤—ã—à–∞—é—Ç rate limit** –±–ª–∞–≥–æ–¥–∞—Ä—è –∑–∞–¥–µ—Ä–∂–∫–∞–º  
‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π retry** –ø—Ä–∏ –æ—à–∏–±–∫–µ 429  
‚úÖ **–ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö** –ø—Ä–∏ –∏—Å—á–µ—Ä–ø–∞–Ω–∏–∏ –ø–æ–ø—ã—Ç–æ–∫  

üéâ **–ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞!**

